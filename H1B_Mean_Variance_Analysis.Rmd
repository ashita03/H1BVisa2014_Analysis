---
title: "MULTIVARIATE ANALYSIS -- H1B VISA DATA -- Mean & Variance Analysis"
author: "Ashita Shetty"
output:
  html_document: default
  pdf_document: default
---

```{r}
library(readr)
library(corpcor)
library(Hotelling)
h1b <- read_csv("C:\\Users\\Dell\\Desktop\\RBS\\Semester II\\Multivariate Analysis\\Assignment\\data\\H1_B-2014.csv")
str(h1b)
```


```{r}
h1b$WAGE_RATE_FROM <- as.numeric(h1b$LCA_CASE_WAGE_RATE_FROM)
h1b$EMPLOYER_POSTAL_CODE <- as.numeric(h1b$LCA_CASE_EMPLOYER_POSTAL_CODE)
h1b$EMP_DIFF <- as.numeric(h1b$EMP_DIFF)
h1b$APP_DIFF <- as.numeric(h1b$APP_DIFF)
h1b$TOTAL_WORKERS <- as.numeric(h1b$TOTAL_WORKERS)
h1b$YR_SOURCE <- as.numeric(h1b$YR_SOURCE_PUB_1)
h1b$NAICS_CODE <- as.numeric(h1b$LCA_CASE_NAICS_CODE)
```


```{r}
x <- dist(scale(h1b[, c("WAGE_RATE_FROM", "EMPLOYER_POSTAL_CODE", "APP_DIFF", "EMP_DIFF", "TOTAL_WORKERS", "YR_SOURCE", "NAICS_CODE")],
                center = FALSE))
as.dist(round(as.matrix(x), 2)[1:12, 1:12])
```


```{r}
num_cols <- h1b[,  c("WAGE_RATE_FROM", "EMPLOYER_POSTAL_CODE", "APP_DIFF", "EMP_DIFF", "TOTAL_WORKERS", "YR_SOURCE", "NAICS_CODE")]
num_cols

```


```{r}
cm <- colMeans(num_cols)
S <- cov(num_cols)
d <- apply(num_cols, MARGIN = 1, function(num_cols)t(num_cols - cm) %*% solve(S) %*% (num_cols- cm))
```


```{r}
S
```

```{r}
cm
```

# Univariate Mean Analysis

#### T- test - One by One

```{r}
with(data=h1b, t.test(WAGE_RATE_FROM[STATUS=="CERTIFIED"],WAGE_RATE_FROM[STATUS=="REJECTED"],var.equal=TRUE))
```

##### **Inference**:
* It can be drawn from the two-sample t-test that the null hypothesis can be rejected, since the p-value is less than 0.05.
* The results highlight how there is a significant difference between the wage rates for "CERTIFIED" and "REJECTED" status group, where the mean wage rates for Certified status is higher than Rejected status.


```{r}
with(data=h1b, t.test(EMPLOYER_POSTAL_CODE[STATUS=="CERTIFIED"], EMPLOYER_POSTAL_CODE[STATUS=="REJECTED"],var.equal=TRUE))
```

##### **Inference**:
* It can be drawn from the two-sample t-test that the null hypothesis is failed to be rejected, since the p-value is greater than 0.05.
* There is not much difference between the mean employer postal codes between the "CERTIFIED" and "REJECTED" statuses.


```{r}
with(data=h1b, t.test(APP_DIFF[STATUS=="CERTIFIED"], APP_DIFF[STATUS=="REJECTED"],var.equal=TRUE))
```

##### **Inference**:
* The results show a significant difference in the mean difference between the applicant's case date and decision date (APP_DIFF) for cases with the status "CERTIFIED" compared to "REJECTED."
* Since the p-value is lesser than 0.05, it can be inferred to reject the null hypothesis.


```{r}
with(data=h1b, t.test(EMP_DIFF[STATUS=="CERTIFIED"], EMP_DIFF[STATUS=="REJECTED"],var.equal=TRUE))
```

##### **Inference**:
* The p-value being lesser than 0.05 indicate that the null hypothesis can be rejected.
* The statistical difference signifies that the on average the difference between the employer's employment end date and start date is higher for "CERTIFIED" cases than for "REJECTED" cases.


```{r}
with(data=h1b, t.test(TOTAL_WORKERS[STATUS=="CERTIFIED"], TOTAL_WORKERS[STATUS=="REJECTED"],var.equal=TRUE))
```

##### **Inference**:
* The p-value being greater than 0.05 indicate that the null hypothesis can be failed to be rejected.
* The statistical difference signifies that there is  a significant difference in the mean total workers between "CERTIFIED" and "REJECTED" cases.


```{r}
with(data=h1b, t.test(YR_SOURCE[STATUS=="CERTIFIED"], YR_SOURCE[STATUS=="REJECTED"],var.equal=TRUE))
```

##### **Inference**:
* The p-value being lesser than 0.05 indicate that the null hypothesis can be rejected.
* The statistical difference signifies that there is not much significant difference in the mean YR Source between "CERTIFIED" and "REJECTED" cases.


```{r}
with(data=h1b, t.test(NAICS_CODE[STATUS=="CERTIFIED"], NAICS_CODE[STATUS=="REJECTED"],var.equal=TRUE))
```

##### **Inference**:
* The p-value being lesser than 0.05 indicate that the null hypothesis can be rejected.
* The statistical difference signifies that there is not much significant difference in the mean NAICS_CODE between "CERTIFIED" and "REJECTED" cases.


# Univariate Variance Analysis

#### Levene's Test

```{r}
matstand <- scale(h1b[, c("WAGE_RATE_FROM", "EMPLOYER_POSTAL_CODE", "APP_DIFF", "EMP_DIFF", "TOTAL_WORKERS", "YR_SOURCE", "NAICS_CODE")])
```

```{r}
matsurv <- matstand[h1b$STATUS=="CERTIFIED",]
```

```{r}
matnosurv <- matstand[h1b$STATUS == "REJECTED",]
vecmediansurv <- apply(matsurv, 2, median)
vecmediansurv

```

```{r}
vecmediannosurv <- apply(matnosurv, 2, median)
matabsdevsurv <- abs(matsurv - matrix(rep(vecmediansurv,nrow(matsurv)),nrow=nrow(matsurv), byrow=TRUE))

matabsdevnosurv <- abs(matnosurv - matrix(rep(vecmediannosurv,nrow(matnosurv)),nrow=nrow(matnosurv), byrow=TRUE))

```

```{r}
matabsdev.all <- rbind(matabsdevsurv,matabsdevnosurv)
matabsdev.all <- data.frame(h1b$STATUS, matabsdev.all)
```

```{r}
attach(h1b)
```

```{r}
t.test(matabsdev.all$WAGE_RATE_FROM[STATUS == "CERTIFIED"],matabsdev.all$WAGE_RATE_FROM[STATUS == "REJECTED"], alternative="less",var.equal = TRUE)
```

##### **Inferences**:
* The p-value > 0.05, therefore, we fail to reject the null hypothesis
* This highlights that there is not much evidence to show that the means of the absolute deviations of 'WAGE_RATE_FROM' between the "CERTIFIED" and "REJECTED" groups are different.


```{r}
t.test(matabsdev.all$EMPLOYER_POSTAL_CODE[STATUS == "CERTIFIED"],matabsdev.all$EMPLOYER_POSTAL_CODE[STATUS == "REJECTED"], alternative="less",var.equal = TRUE)
```

##### **Inferences**:
* The p-value > 0.05, therefore, we fail to reject the null hypothesis
* This highlights that there is not much evidence to show that the means of the absolute deviations of 'EMPLOYER_POSTAL_CODE' between the "CERTIFIED" and "REJECTED" groups are different.


```{r}
t.test(matabsdev.all$APP_DIFF[STATUS == "CERTIFIED"],matabsdev.all$APP_DIFF[STATUS == "REJECTED"], alternative="less",var.equal = TRUE)
```

##### **Inferences**:
* The p-value > 0.05, therefore, we fail to reject the null hypothesis
* This highlights that there is not much evidence to show that the means of the absolute deviations of 'APP_DIFF' between the "CERTIFIED" and "REJECTED" groups are different.


```{r}
t.test(matabsdev.all$EMP_DIFF[STATUS == "CERTIFIED"],matabsdev.all$EMP_DIFF[STATUS == "REJECTED"], alternative="less",var.equal = TRUE)
```

##### **Inferences**:
* The p-value > 0.05, therefore, we fail to reject the null hypothesis
* This highlights that there is not much evidence to show that the means of the absolute deviations of 'EMP_DIFF' between the "CERTIFIED" and "REJECTED" groups are different.


```{r}
t.test(matabsdev.all$TOTAL_WORKERS[STATUS == "CERTIFIED"],matabsdev.all$TOTAL_WORKERS[STATUS == "REJECTED"], alternative="less",var.equal = TRUE)
```

##### **Inferences**:
* The p-value > 0.05, therefore, we fail to reject the null hypothesis
* This highlights that there is not much evidence to show that the means of the absolute deviations of 'TOTAL_WORKERS' between the "CERTIFIED" and "REJECTED" groups are different.


```{r}
t.test(matabsdev.all$YR_SOURCE[STATUS == "CERTIFIED"],matabsdev.all$YR_SOURCE[STATUS == "REJECTED"], alternative="less",var.equal = TRUE)
```

##### **Inferences**:
* The p-value > 0.05, therefore, we fail to reject the null hypothesis
* This highlights that there is not much evidence to show that the means of the absolute deviations of 'YR_SOURCE' between the "CERTIFIED" and "REJECTED" groups are different.


```{r}
t.test(matabsdev.all$NAICS_CODE[STATUS == "CERTIFIED"],matabsdev.all$NAICS_CODE[STATUS == "REJECTED"], alternative="less",var.equal = TRUE)
```

##### **Inferences**:
* The p-value > 0.05, therefore, we fail to reject the null hypothesis
* This highlights that there is not much evidence to show that the means of the absolute deviations of 'NAICS_CODE' between the "CERTIFIED" and "REJECTED" groups are different.


```{r}
matstand.all <- data.frame(STATUS, matstand)
colnames(matstand.all) <- colnames(c("WAGE_RATE_FROM", "EMPLOYER_POSTAL_CODE", "APP_DIFF", "EMP_DIFF", "TOTAL_WORKERS", "YR_SOURCE", "NAICS_CODE"))

t2testsparr <- hotelling.test(WAGE_RATE_FROM+EMPLOYER_POSTAL_CODE+APP_DIFF+EMP_DIFF+TOTAL_WORKERS+YR_SOURCE+NAICS_CODE~ STATUS,data=matstand.all)
cat("T2 statistic =",t2testsparr$stat[[1]],"\n")
```

##### **Inference**:
* The higher T2 statistic value suggests that there is a significant difference in the overall pattern of multivariate data between the "CERTIFIED" and "REJECTED" groups.


```{r}
print(t2testsparr)
```

##### **Inference**:
* The lower p-value indicating strong evidence against the null hypothesis. This along with the Test stat indicates a substantial overall difference between the "CERTIFIED" and "REJECTED" groups.


```{r}
# In the above we standardized using scale function
matabsdev.all
```

```{r}
d.all <- data.frame(STATUS, sqrt(rowSums(matabsdev.all[,-1]^2)))
d.all
```

```{r}
colnames(d.all)[2] <- "dij"
d.all
```

```{r}
head(d.all)
```

```{r}
with(d.all, t.test(dij[STATUS=="CERTIFIED"], dij[STATUS=="REJECTED"],var.equal=TRUE, alternative="less"))
```

##### **Inference**:
* The p-value being higher than 0.05 indicates that the null hypothesis is failed to reject.


```{r}
sprintf("d-values for Certified status: Mean = %2.3f, Variance = %2.3f",mean(d.all$dij[STATUS=="CERTIFIED"]),var(d.all$dij[STATUS=="CERTIFIED"]))
```

##### **Inference**:
* These values provide the distribution of Euclidean distances for cases labeled as "CERTIFIED", showcasing the central tendency of the distances with the mean, and the how spread out the distances are around the mean via the variance.


```{r}
sprintf("d-values for Rejected Status: Mean = %2.3f, Variance = %2.3f",mean(d.all$dij[STATUS=="REJECTED"]),var(d.all$dij[STATUS=="REJECTED"]))
```

##### **Inference**:
* These values provide the distribution of Euclidean distances for cases labeled as "REJECTED", showcasing the central tendency of the distances with the mean, and the how spread out the distances are around the mean via the variance.


```{r}
library(car)
```

```{r}
leveneTest(WAGE_RATE_FROM ~ STATUS, data=h1b)
```

##### **Inference**:
* The low p-value (<0.05)  indicates that the null hypothesis can be rejected which signifies that the variance for 'WAGE_RATE_FROM' are not the same across different "STATUS"


```{r}
leveneTest(EMPLOYER_POSTAL_CODE ~ STATUS, data=h1b)

```

##### **Inference**:
* The  p-value indicates that the null hypothesis can be failed to be rejected which signifies that the variance for 'EMPLOYER_POSTAL_CODE' are similar across different "STATUS".


```{r}
leveneTest(APP_DIFF ~ STATUS, data=h1b)

```

##### **Inference**:
* The low p-value (<0.05)  indicates that the null hypothesis can be rejected which signifies that the variance for 'APP_DIFF' are not the same across different "STATUS"


```{r}
leveneTest(EMP_DIFF ~ STATUS, data=h1b)

```

##### **Inference**:
* The low p-value (<0.05)  indicates that the null hypothesis can be rejected which signifies that the variance for 'EMP_DIFF' are not the same across different "STATUS"


```{r}
leveneTest(TOTAL_WORKERS ~ STATUS, data=h1b)

```

##### **Inference**:
* The  p-value indicates that the null hypothesis can be failed to be rejected which signifies that the variance for 'TOTAL_WORKERS' are similar across different "STATUS"


```{r}
leveneTest(YR_SOURCE ~ STATUS, data=h1b)
```

##### **Inference**:
* The low p-value (<0.05)  indicates that the null hypothesis can be rejected which signifies that the variance for 'YR_SOURCE' are not the same across different "STATUS"


```{r}
leveneTest(NAICS_CODE ~ STATUS, data=h1b)

```

##### **Inference**:
* The low p-value (<0.05)  indicates that the null hypothesis can be rejected which signifies that the variance for 'NAICS_CODE' are not the same across different "STATUS"


#### **ANOVA**

```{r}
summary(aov(WAGE_RATE_FROM ~ STATUS))
```

##### **Inference**:
* The low p-value (<0.05)  indicates that the null hypothesis can be rejected which signifies that the mean value of 'WAGE_RATE' are different for different "STATUS"


```{r}
summary(aov(EMPLOYER_POSTAL_CODE ~ STATUS))
```

##### **Inference**:
* The  p-value indicates that the null hypothesis can be failed to be rejected which signifies that the mean value of 'EMPLOYER_POSTAL_CODE' are similar for different "STATUS"


```{r}
summary(aov(APP_DIFF ~ STATUS))

```

##### **Inference**:
* The low p-value (<0.05)  indicates that the null hypothesis can be rejected which signifies that the mean value of 'APP_DIFF' are different for different "STATUS"


```{r}
summary(aov(EMP_DIFF ~ STATUS))
```

##### **Inference**:
* The low p-value (<0.05)  indicates that the null hypothesis can be rejected which signifies that the mean value of 'EMP_DIFF' are different for different "STATUS"


```{r}
summary(aov(TOTAL_WORKERS ~ STATUS))
```

##### **Inference**:
* The p-value indicates that the null hypothesis can be failed to be rejected which signifies that the mean value of 'TOTAL_WORKERS' are similar for different "STATUS"


```{r}
summary(aov(YR_SOURCE ~ STATUS))
```

##### **Inference**:
* The p-value indicates that the null hypothesis can be failed to be rejected which signifies that the mean value of 'YR_SOURCE' are similar for different "STATUS"


```{r}
summary(aov(NAICS_CODE ~ STATUS))

```

##### **Inference**:
* The low p-value (<0.05)  indicates that the null hypothesis can be rejected which signifies that the mean value of 'NAICS_CODE' are different for different "STATUS"


# Multivariate Mean Analysis

#### T- test - Hotelling

```{r}
t2testh1b <- hotelling.test(WAGE_RATE_FROM + EMPLOYER_POSTAL_CODE + APP_DIFF+ EMP_DIFF+TOTAL_WORKERS+YR_SOURCE+NAICS_CODE ~ STATUS, data=h1b)
# Output of the function hotelling.test is given
cat("T2 statistic =",t2testh1b$stat[[1]],"\n")
```

##### **Inferences**:
* The higher value of T2 Statistic indicates that there is a significant difference in the mean vectors of the variables included in the test.


```{r}
print(t2testh1b)
```

##### **Inferences**:
* The low p-value (<0.05)  (<0.05)  (0) suggests strong evidence to fail reject the null hypothesis signifying that there is no difference in the mean vectors between the groups.


# Multivariate Variance Analysis


#### Mahalanobis

```{r}
library(stats)

h1b_MD <- mahalanobis(num_cols, cm, S)

```

* Mahalanobis Distance is a measure of the distance between a point and a distribution, considering corresponding correlations between variables.


```{r}
h1b$pvalues <- pchisq(h1b_MD, df=3, lower.tail=FALSE)
h1b
```

* The above demonstrates the percent chi-squared.

#### BoxM Test

```{r}
library(biotools)
```

```{r}
boxM(h1b[,c("WAGE_RATE_FROM", "EMPLOYER_POSTAL_CODE", "APP_DIFF", "EMP_DIFF", "TOTAL_WORKERS", "YR_SOURCE", "NAICS_CODE")],STATUS)
```

##### **Inference**:
* The low p-value (<0.05)  is indicative of the evidence that the null hypothesis can be rejected. This indicates that the covariance matrices are not equal across different levels of the "STATUS"


#### MANOVA

```{r}
summary(manova(as.matrix(h1b[,c("WAGE_RATE_FROM", "EMPLOYER_POSTAL_CODE", "APP_DIFF", "EMP_DIFF", "TOTAL_WORKERS", "YR_SOURCE", "NAICS_CODE")])~ STATUS))
```

##### **Inference**:
* The low p-value (<0.05) is indicative of the evidence to reject the null hypothesis. This signifies that the mean vectors of the specified variables are different across different "STATUS".

